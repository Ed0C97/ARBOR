# =============================================================================
# A.R.B.O.R. Enterprise - Environment Variables
# =============================================================================
# Copy this file to .env and fill in the values marked with <REQUIRED>.
# Variables with defaults can be left as-is for local development.
#
# SCHEMA-AGNOSTIC ARCHITECTURE:
# ARBOR can work with ANY database schema. Configure your data source below
# using SOURCE_DATABASE_URL and SOURCE_SCHEMA_CONFIG.
# =============================================================================

# =============================================================================
#  APPLICATION
# =============================================================================
APP_NAME=arbor-enterprise
APP_ENV=development
APP_DEBUG=true
APP_VERSION=1.0.0
APP_SECRET_KEY=change-me-to-a-random-secret-key          # <REQUIRED in production>

# GCP Project ID (for Secret Manager in production)
GCP_PROJECT_ID=

# =============================================================================
#  BACKEND SERVER
# =============================================================================
BACKEND_HOST=0.0.0.0
BACKEND_PORT=8000

# =============================================================================
#  SOURCE DATABASE — READ-ONLY (your data)
# =============================================================================
# The database containing the entities you want ARBOR to enrich.
# This can be ANY database with ANY schema - configure the mapping below.

# Connection URL (supports postgres, mysql, etc.)
SOURCE_DATABASE_URL=postgresql+asyncpg://user:password@localhost:5432/your_database    # <REQUIRED>
DATABASE_URL=                                            # DEPRECATED: use SOURCE_DATABASE_URL
DATABASE_SSL=true

# =============================================================================
#  SCHEMA CONFIGURATION — Map your tables to ARBOR
# =============================================================================
# ARBOR is schema-agnostic. Define how YOUR tables map to ARBOR's unified format.
#
# Option 1: Inline JSON (for simple schemas)
# SOURCE_SCHEMA_CONFIG='[{"entity_type":"product","table_name":"products","id_column":"id","required_mappings":{"name":"product_name"},"optional_mappings":{"category":"category_id","description":"desc"},"text_fields_for_embedding":["product_name","desc"]}]'
#
# Option 2: Path to JSON file (for complex schemas)
# SOURCE_SCHEMA_CONFIG_FILE=/path/to/schema.json
#
# If neither is set, ARBOR uses default brands/venues schema for backwards compatibility.

SOURCE_SCHEMA_CONFIG=
SOURCE_SCHEMA_CONFIG_FILE=

# JSON Schema Format:
# [
#   {
#     "entity_type": "product",       # Your entity name (used in API)
#     "table_name": "products",        # Actual table name in your DB
#     "id_column": "id",               # Primary key column
#     "required_mappings": {
#       "name": "product_name"         # Maps ARBOR field -> your column
#     },
#     "optional_mappings": {
#       "category": "cat_id",          # Optional: set to null if not available
#       "city": null,
#       "description": "desc"
#     },
#     "text_fields_for_embedding": ["product_name", "desc"],  # Columns for AI embedding
#     "active_filter_column": "is_active",  # Optional: filter active records
#     "active_filter_value": true
#   }
# ]

# =============================================================================
#  ARBOR DATABASE — READ-WRITE (enrichments, gold standard, feedback)
# =============================================================================
ARBOR_DATABASE_URL=postgresql+asyncpg://user:password@localhost:5432/arbor_db   # <REQUIRED>
ARBOR_DATABASE_SSL=true

# Connection Pool Tuning
DB_POOL_SIZE=40
DB_MAX_OVERFLOW=20
DB_POOL_RECYCLE=1800
DB_POOL_PRE_PING=true

# =============================================================================
#  QDRANT — Vector Search
# =============================================================================
QDRANT_URL=http://localhost:6333
QDRANT_API_KEY=
QDRANT_COLLECTION=entities_vectors
QDRANT_PREFER_GRPC=true

# =============================================================================
#  NEO4J — Knowledge Graph
# =============================================================================
NEO4J_URI=bolt://localhost:7687
NEO4J_USER=neo4j
NEO4J_PASSWORD=change-me                                   # <REQUIRED in production>

# =============================================================================
#  REDIS — Caching & Sessions
# =============================================================================
REDIS_URL=redis://localhost:6379/0

# =============================================================================
#  GOOGLE GEMINI — Primary LLM (Text + Vision)
# =============================================================================
GOOGLE_API_KEY=                                             # <REQUIRED>
GOOGLE_MODEL=gemini-3-pro-preview

# =============================================================================
#  COHERE — Embedding + Reranking
# =============================================================================
COHERE_API_KEY=                                             # <REQUIRED>
COHERE_EMBEDDING_MODEL=embed-v4.0
COHERE_RERANK_MODEL=rerank-v4.0-pro

# =============================================================================
#  FALLBACK LLM PROVIDERS (optional)
# =============================================================================
# OpenAI
OPENAI_API_KEY=
OPENAI_MODEL=gpt-4o
OPENAI_EMBEDDING_MODEL=text-embedding-3-small

# Azure OpenAI
AZURE_API_KEY=
AZURE_API_BASE=

# Anthropic
ANTHROPIC_API_KEY=
ANTHROPIC_MODEL=claude-sonnet-4-20250514

# Groq
GROQ_API_KEY=
GROQ_MODEL=llama-3.3-70b-versatile

# Mistral
MISTRAL_API_KEY=
MISTRAL_MODEL=mistral-large-latest
MISTRAL_EMBEDDING_MODEL=mistral-embed

# =============================================================================
#  LLM ROUTING — Provider Selection
# =============================================================================
LLM_PRIMARY_PROVIDER=google
LLM_VISION_PROVIDER=google
LLM_EMBEDDING_PROVIDER=cohere
LLM_FAST_PROVIDER=google

# =============================================================================
#  GOOGLE MAPS — Venue Scraping
# =============================================================================
GOOGLE_MAPS_API_KEY=

# =============================================================================
#  AUTH0 — Authentication
# =============================================================================
AUTH0_DOMAIN=your-tenant.auth0.com
AUTH0_API_AUDIENCE=https://api.arbor.io

# =============================================================================
#  LANGFUSE — LLM Observability
# =============================================================================
LANGFUSE_PUBLIC_KEY=
LANGFUSE_SECRET_KEY=
LANGFUSE_HOST=https://cloud.langfuse.com

# =============================================================================
#  KAFKA — Event Streaming
# =============================================================================
KAFKA_BOOTSTRAP_SERVERS=localhost:9092
KAFKA_DLQ_TOPIC=arbor-dlq

# =============================================================================
#  CELERY — Background Jobs
# =============================================================================
CELERY_BROKER_URL=redis://localhost:6379/1
CELERY_RESULT_BACKEND=redis://localhost:6379/2

# =============================================================================
#  TEMPORAL — Workflow Orchestration
# =============================================================================
TEMPORAL_HOST=localhost:7233

# =============================================================================
#  OPENTELEMETRY — Distributed Tracing
# =============================================================================
OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4317
OTEL_SERVICE_NAME=arbor-api

# =============================================================================
#  RESILIENCE TUNING
# =============================================================================
# Circuit Breaker
CIRCUIT_BREAKER_FAIL_MAX=5
CIRCUIT_BREAKER_RESET_TIMEOUT=60

# Retry Policy
RETRY_MAX_ATTEMPTS=3
RETRY_INITIAL_WAIT=0.5
RETRY_MAX_WAIT=5.0

# Semantic Cache
SEMANTIC_CACHE_THRESHOLD=0.90
CACHE_TTL=3600

# Rate Limiting
RATE_LIMIT_REQUESTS=100
RATE_LIMIT_WINDOW=60

# Node Timeouts (seconds)
TIMEOUT_INTENT_NODE=2.0
TIMEOUT_SEARCH_NODE=5.0
TIMEOUT_SYNTHESIS_NODE=15.0
TIMEOUT_TOTAL_REQUEST=25.0

# =============================================================================
#  FRONTEND (Next.js)
# =============================================================================
NEXT_PUBLIC_API_URL=http://localhost:8000
NEXT_PUBLIC_AUTH0_DOMAIN=your-tenant.auth0.com
NEXT_PUBLIC_AUTH0_CLIENT_ID=
NEXT_PUBLIC_MAPBOX_TOKEN=

# =============================================================================
#  TESTING (only needed for E2E / integration)
# =============================================================================
# E2E_BASE_URL=http://localhost:3000
# E2E_API_URL=http://localhost:8000
# E2E_TEST_EMAIL=test@arbor.app
# E2E_TEST_PASSWORD=test-password-123
# VCR_RECORD_MODE=none
